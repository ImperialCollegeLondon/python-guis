#:import chain itertools.chain
#:set text_factor 1.6

<MainWindow>:
    orientation: "horizontal"
    padding: 5
    spacing: 5

    ControlField:
        id: control_field
        size_hint: (.35, 1)

    Matplotlib:
        id: play_field
        size_hint: (0.65, 1)

<DegreeButton@ToggleButton>:
    size_hint: (0.7 / 3, None)
    height: 60
    group: "degree"
    text: "1"
    state: "down" if self.parent.degree == int(self.text) else "normal"
    allow_no_selection: False
    on_press: self.parent.degree = int(self.text)

<ControlField>:
    orientation: "lr-tb"
    spacing: 5
    padding: 5
    canvas:
        Color:
            rgba: 0.1, 0.1, 0.12, 1

        Rectangle:
            size: self.size
            pos: self.pos

    Label:
        text_size: self.width, None
        size: self.texture_size
        size_hint: (1, None)
        halign: "left"
        text: "Gaussian filter width:"

    Label:
        text_size: None, gaussian_width.height
        size: self.texture_size
        size_hint: (0.1, None)
        halign: "center"
        valign: "middle"
        text: str(gaussian_width.value)

    Slider:
        id: gaussian_width
        size_hint: (0.9, None)
        min: 1
        max: 10
        step: 1
        value: 5
        value_track: True
        value_track_color: 1, 0, 0, 1
        
    Label:
        text_size: self.width, None
        size: self.texture_size
        size_hint: (1, None)
        halign: "left"
        text: "Spline parameters:"

    Label:
        id: degree_label
        text_size: self.width, None
        size: self.texture_size[0], int(self.texture_size[1] * text_factor)
        size_hint: (0.30, None)
        halign: "left"
        valign: "middle"
        text: "Degree:"

    DegreeButton:
        height: degree_label.height
        text: "1"

    DegreeButton:
        height: degree_label.height
        text: "3"

    DegreeButton:
        height: degree_label.height
        text: "6"

    Label:
        id: resolution_label
        text_size: self.width, None
        size: self.texture_size[0], int(self.texture_size[1] * text_factor)
        size_hint: (0.40, None)
        halign: "left"
        valign: "middle"
        text: "Resolution:"

    TextInput:
        size_hint: (0.60, None)
        height: resolution_label.height
        halign: "left"
        valign: "middle"
        text: str(root.resolution)
        multiline: False
        on_text: root.on_resolution_change(self)

    Button:
        size_hint: (1, None)
        text: "Perform segmentation"
        disabled: len(root.parent.play_field.control_points) <= 2
        on_press: root.parent.on_segment()

    Button:
        size_hint: (1, None)
        text: "Remove all"
        disabled: len(root.parent.control_points) == 0
        on_press: root.parent.control_points = []
